<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-info { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ” JavaScriptè°ƒè¯•é¡µé¢</h1>
    
    <div class="debug-info">
        <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
        <div id="systemStatus">æ£€æŸ¥ä¸­...</div>
    </div>
    
    <div class="debug-info">
        <h3>ğŸ“ æ–‡ä»¶åŠ è½½çŠ¶æ€</h3>
        <div id="fileStatus">æ£€æŸ¥ä¸­...</div>
    </div>
    
    <div class="debug-info">
        <h3>ğŸ¯ é¢˜ç›®æ•°æ®</h3>
        <div id="questionStatus">æ£€æŸ¥ä¸­...</div>
    </div>
    
    <div class="debug-info">
        <h3>ğŸ”§ åŠŸèƒ½æµ‹è¯•</h3>
        <button onclick="testBasicFunction()">æµ‹è¯•åŸºç¡€åŠŸèƒ½</button>
        <button onclick="testQuestions()">æµ‹è¯•é¢˜ç›®æ•°æ®</button>
        <button onclick="testLocalStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
        <div id="testResults"></div>
    </div>
    
    <script>
        // åŸºç¡€æ£€æŸ¥
        function checkSystem() {
            const status = document.getElementById('systemStatus');
            const results = [];
            
            // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
            results.push(`âœ… æµè§ˆå™¨: ${navigator.userAgent.substring(0, 50)}...`);
            results.push(`âœ… JavaScript: ${typeof window !== 'undefined' ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
            results.push(`âœ… localStorage: ${typeof Storage !== 'undefined' ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
            results.push(`âœ… DOM: ${typeof document !== 'undefined' ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
            
            status.innerHTML = results.join('<br>');
        }
        
        // æ£€æŸ¥æ–‡ä»¶åŠ è½½
        function checkFiles() {
            const status = document.getElementById('fileStatus');
            const results = [];
            
            // æ£€æŸ¥CSSæ–‡ä»¶
            const cssLinks = document.querySelectorAll('link[rel="stylesheet"]');
            results.push(`ğŸ“„ CSSæ–‡ä»¶: ${cssLinks.length} ä¸ª`);
            cssLinks.forEach((link, i) => {
                results.push(`  - ${i+1}: ${link.href}`);
            });
            
            // æ£€æŸ¥JSæ–‡ä»¶
            const jsScripts = document.querySelectorAll('script[src]');
            results.push(`ğŸ“„ JSæ–‡ä»¶: ${jsScripts.length} ä¸ª`);
            jsScripts.forEach((script, i) => {
                results.push(`  - ${i+1}: ${script.src}`);
            });
            
            status.innerHTML = results.join('<br>');
        }
        
        // æ£€æŸ¥é¢˜ç›®æ•°æ®
        function checkQuestions() {
            const status = document.getElementById('questionStatus');
            
            try {
                // åŠ¨æ€åŠ è½½ä¸»JSæ–‡ä»¶æ¥æµ‹è¯•
                const script = document.createElement('script');
                script.src = 'js/main.js';
                script.onload = function() {
                    const results = [];
                    results.push(`âœ… JSæ–‡ä»¶åŠ è½½æˆåŠŸ`);
                    
                    // æ£€æŸ¥å˜é‡
                    if (typeof QUESTIONS !== 'undefined') {
                        results.push(`âœ… QUESTIONSå˜é‡å­˜åœ¨ï¼Œå…± ${QUESTIONS.length} é“é¢˜`);
                        
                        // æ£€æŸ¥é¢˜ç›®ç»“æ„
                        const sampleQuestion = QUESTIONS[0];
                        results.push(`âœ… é¢˜ç›®ç»“æ„: id=${sampleQuestion.id}, text=${sampleQuestion.text.substring(0, 20)}..., dimension=${sampleQuestion.dimension}`);
                        
                        // æ£€æŸ¥ç»´åº¦åˆ†å¸ƒ
                        const dimensions = {};
                        QUESTIONS.forEach(q => {
                            dimensions[q.dimension] = (dimensions[q.dimension] || 0) + 1;
                        });
                        results.push(`ğŸ“Š ç»´åº¦åˆ†å¸ƒ:`);
                        Object.keys(dimensions).forEach(dim => {
                            results.push(`  - ${dim}: ${dimensions[dim]} é¢˜`);
                        });
                        
                        // æµ‹è¯•éšæœºé€‰æ‹©
                        if (typeof selectRandomQuestions === 'function') {
                            const selected = selectRandomQuestions();
                            results.push(`âœ… éšæœºé€‰æ‹©å‡½æ•°æ­£å¸¸ï¼Œé€‰æ‹©äº† ${selected.length} é“é¢˜`);
                        } else {
                            results.push(`âŒ selectRandomQuestionså‡½æ•°ä¸å­˜åœ¨`);
                        }
                        
                    } else {
                        results.push(`âŒ QUESTIONSå˜é‡ä¸å­˜åœ¨`);
                    }
                    
                    if (typeof initTestPage === 'function') {
                        results.push(`âœ… initTestPageå‡½æ•°å­˜åœ¨`);
                    } else {
                        results.push(`âŒ initTestPageå‡½æ•°ä¸å­˜åœ¨`);
                    }
                    
                    status.innerHTML = results.join('<br>');
                };
                script.onerror = function() {
                    status.innerHTML = `âŒ JSæ–‡ä»¶åŠ è½½å¤±è´¥`;
                };
                document.head.appendChild(script);
                
            } catch (error) {
                status.innerHTML = `âŒ é”™è¯¯: ${error.message}`;
            }
        }
        
        // æµ‹è¯•åŸºç¡€åŠŸèƒ½
        function testBasicFunction() {
            const results = document.getElementById('testResults');
            const testResults = [];
            
            try {
                // æµ‹è¯•DOMæ“ä½œ
                const testDiv = document.createElement('div');
                testDiv.innerHTML = 'æµ‹è¯•DOMæ“ä½œ';
                document.body.appendChild(testDiv);
                testResults.push(`âœ… DOMæ“ä½œæ­£å¸¸`);
                document.body.removeChild(testDiv);
                
                // æµ‹è¯•localStorage
                localStorage.setItem('test', 'value');
                const stored = localStorage.getItem('test');
                localStorage.removeItem('test');
                testResults.push(`âœ… localStorageæ­£å¸¸ï¼Œæµ‹è¯•å€¼: ${stored}`);
                
                // æµ‹è¯•äº‹ä»¶ç›‘å¬
                let eventFired = false;
                const testButton = document.createElement('button');
                testButton.textContent = 'æµ‹è¯•äº‹ä»¶';
                testButton.addEventListener('click', () => {
                    eventFired = true;
                });
                document.body.appendChild(testButton);
                testButton.click();
                document.body.removeChild(testButton);
                testResults.push(`âœ… äº‹ä»¶ç›‘å¬æ­£å¸¸ï¼Œäº‹ä»¶è§¦å‘: ${eventFired}`);
                
                results.innerHTML = `<div class="success">${testResults.join('<br>')}</div>`;
                
            } catch (error) {
                results.innerHTML = `<div class="error">âŒ åŸºç¡€åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // æµ‹è¯•é¢˜ç›®æ•°æ®
        function testQuestions() {
            const results = document.getElementById('testResults');
            if (typeof QUESTIONS === 'undefined') {
                results.innerHTML = `<div class="error">âŒ è¯·å…ˆåŠ è½½js/main.jsæ–‡ä»¶</div>`;
                return;
            }
            
            try {
                const testResults = [];
                testResults.push(`ğŸ“Š é¢˜ç›®æ€»æ•°: ${QUESTIONS.length}`);
                
                // æ£€æŸ¥æ•°æ®ç»“æ„
                const firstQuestion = QUESTIONS[0];
                testResults.push(`ğŸ“‹ é¢˜ç›®ç¤ºä¾‹: ${firstQuestion.text.substring(0, 30)}...`);
                testResults.push(`ğŸ“‹ ç»´åº¦: ${firstQuestion.dimension}`);
                testResults.push(`ğŸ“‹ ç±»å‹: ${firstQuestion.type}`);
                
                // æ£€æŸ¥éšæœºé€‰æ‹©
                if (typeof selectRandomQuestions === 'function') {
                    const selected = selectRandomQuestions();
                    testResults.push(`ğŸ¯ éšæœºé€‰æ‹©ç»“æœ: ${selected.length} é“é¢˜`);
                    
                    // æ£€æŸ¥ç»´åº¦åˆ†å¸ƒ
                    const dimCount = {};
                    selected.forEach(q => {
                        dimCount[q.dimension] = (dimCount[q.dimension] || 0) + 1;
                    });
                    Object.keys(dimCount).forEach(dim => {
                        testResults.push(`  - ${dim}: ${dimCount[dim]} é¢˜`);
                    });
                }
                
                results.innerHTML = `<div class="success">${testResults.join('<br>')}</div>`;
                
            } catch (error) {
                results.innerHTML = `<div class="error">âŒ é¢˜ç›®æ•°æ®æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // æµ‹è¯•æœ¬åœ°å­˜å‚¨
        function testLocalStorage() {
            const results = document.getElementById('testResults');
            
            try {
                const testResults = [];
                
                // æµ‹è¯•å†™å…¥
                const testData = { test: 'value', timestamp: Date.now() };
                localStorage.setItem('rpiDebugTest', JSON.stringify(testData));
                testResults.push(`âœ… å†™å…¥æµ‹è¯•æ•°æ®æˆåŠŸ`);
                
                // æµ‹è¯•è¯»å–
                const readData = JSON.parse(localStorage.getItem('rpiDebugTest'));
                testResults.push(`âœ… è¯»å–æµ‹è¯•æ•°æ®æˆåŠŸ: ${JSON.stringify(readData)}`);
                
                // æµ‹è¯•åˆ é™¤
                localStorage.removeItem('rpiDebugTest');
                testResults.push(`âœ… åˆ é™¤æµ‹è¯•æ•°æ®æˆåŠŸ`);
                
                results.innerHTML = `<div class="success">${testResults.join('<br>')}</div>`;
                
            } catch (error) {
                results.innerHTML = `<div class="error">âŒ æœ¬åœ°å­˜å‚¨æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æ£€æŸ¥
        window.onload = function() {
            setTimeout(() => {
                checkSystem();
                checkFiles();
                checkQuestions();
            }, 1000);
        };
    </script>
</body>
</html>